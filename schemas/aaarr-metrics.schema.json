{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/aaarr-metrics",
  "title": "AAARR Metrics Schema",
  "description": "Customer lifecycle metrics across 5 stages (Acquisition, Activation, Retention, Referral, Revenue)",
  "type": "object",
  "required": ["type", "version", "last_updated", "title", "stages"],
  "properties": {
    "type": { "const": "aaarr-metrics" },
    "version": { "type": "string" },
    "last_updated": { "type": "string", "format": "date" },
    "title": { "type": "string" },
    "lean_viability_ref": { "type": "string" },
    "north_star_ref": { "type": "string" },
    "stages": {
      "type": "object",
      "required": ["acquisition", "activation", "retention", "referral", "revenue"],
      "properties": {
        "acquisition": { "$ref": "#/definitions/AARRRStage" },
        "activation": { "$ref": "#/definitions/AARRRStage" },
        "retention": { "$ref": "#/definitions/AARRRStage" },
        "referral": { "$ref": "#/definitions/AARRRStage" },
        "revenue": { "$ref": "#/definitions/AARRRStage" }
      }
    }
  },
  "definitions": {
    "AARRRStage": {
      "type": "object",
      "required": ["stage_goal", "metrics"],
      "properties": {
        "stage_goal": { "type": "string" },
        "metrics": {
          "type": "array",
          "items": { "$ref": "#/definitions/Metric" }
        }
      }
    },
    "Metric": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^aaarr\\.(acquisition|activation|retention|referral|revenue)\\.[a-z][a-z0-9-]*$"
        },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "target": { "$ref": "#/definitions/MetricValue" },
        "current": { "$ref": "#/definitions/MetricValue" },
        "gap": { "$ref": "#/definitions/GapValue" }
      }
    },
    "MetricValue": {
      "type": "object",
      "properties": {
        "rate": { "type": "number", "minimum": 0 },
        "period": { "type": "string", "enum": ["day", "week", "month", "quarter", "year", "hour", "score", "user"] },
        "amount": { "type": "number", "minimum": 0 },
        "currency": { "type": "string", "enum": ["USD", "EUR", "PLN", "GBP"] },
        "percentage": { "type": "number", "minimum": 0, "maximum": 100 },
        "imported_from": { "type": "string" }
      }
    },
    "GapValue": {
      "type": "object",
      "properties": {
        "rate": { "type": "number" },
        "amount": { "type": "number" },
        "percentage": { "type": "number" }
      }
    }
  }
}
