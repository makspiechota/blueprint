{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/lean-viability",
  "title": "Lean 1-2-3 Viability Schema",
  "description": "Viability layer using Ash Maurya's Lean 1-2-3 framework for work-backwards calculations",
  "type": "object",
  "required": ["type", "version", "last_updated", "title", "time_horizon", "success_criteria", "calculations", "targets"],
  "properties": {
    "type": { "const": "lean-viability" },
    "version": { "type": "string" },
    "last_updated": { "type": "string", "format": "date" },
    "title": { "type": "string" },
    "lean_canvas_ref": { "type": "string" },
    "time_horizon": { "$ref": "#/definitions/TimeHorizon" },
    "success_criteria": {
      "type": "object",
      "required": ["annual_revenue", "target_year"],
      "properties": {
        "annual_revenue": { "$ref": "#/definitions/CurrencyAmount" },
        "target_year": { "type": "number", "minimum": 1 }
      }
    },
    "calculations": {
      "type": "object",
      "required": ["annual_revenue_per_customer", "required_customers", "customer_acquisition_rate", "monthly_acquisition_target"],
      "properties": {
        "annual_revenue_per_customer": {
          "allOf": [
            { "$ref": "#/definitions/CurrencyAmount" },
            {
              "type": "object",
              "required": ["basis"],
              "properties": {
                "basis": { "type": "string" }
              }
            }
          ]
        },
        "required_customers": {
          "type": "object",
          "required": ["count", "formula"],
          "properties": {
            "count": { "type": "number", "minimum": 0 },
            "formula": { "type": "string" }
          }
        },
        "customer_acquisition_rate": {
          "allOf": [
            { "$ref": "#/definitions/RatePeriod" },
            {
              "type": "object",
              "required": ["formula"],
              "properties": {
                "formula": { "type": "string" }
              }
            }
          ]
        },
        "monthly_acquisition_target": {
          "allOf": [
            { "$ref": "#/definitions/RatePeriod" },
            {
              "type": "object",
              "required": ["formula"],
              "properties": {
                "formula": { "type": "string" }
              }
            }
          ]
        }
      }
    },
    "targets": {
      "type": "object",
      "properties": {
        "acquisition": {
          "type": "object",
          "properties": {
            "monthly_signups": { "$ref": "#/definitions/RatePeriod" }
          }
        },
        "activation": {
          "type": "object"
        },
        "retention": {
          "type": "object"
        },
        "referral": {
          "type": "object"
        },
        "revenue": {
          "type": "object",
          "properties": {
            "arpu": {
              "allOf": [
                { "$ref": "#/definitions/CurrencyAmount" },
                {
                  "type": "object",
                  "required": ["period"],
                  "properties": {
                    "period": { "type": "string", "enum": ["day", "week", "month", "quarter", "year"] }
                  }
                }
              ]
            }
          }
        }
      }
    }
  },
  "definitions": {
    "CurrencyAmount": {
      "type": "object",
      "required": ["amount", "currency"],
      "properties": {
        "amount": { "type": "number", "minimum": 0 },
        "currency": { "type": "string", "enum": ["USD", "EUR", "PLN", "GBP"] }
      }
    },
    "RatePeriod": {
      "type": "object",
      "required": ["rate", "period"],
      "properties": {
        "rate": { "type": "number", "minimum": 0 },
        "period": { "type": "string", "enum": ["day", "week", "month", "quarter", "year"] }
      }
    },
    "TimeHorizon": {
      "type": "object",
      "required": ["duration", "unit"],
      "properties": {
        "duration": { "type": "number", "minimum": 1, "maximum": 10 },
        "unit": { "type": "string", "enum": ["years", "months"] }
      }
    }
  }
}
