type: user-story
id: step-execution
productName: test
version: '1.0'
last_updated: '2026-01-14'
name: Execute individual workflow steps
description: >-
  As the system, I need to execute each step by assembling context,
  calling the provider adapter, and processing output,
  so that each agent in the workflow performs its task.
status: planned
acceptance_criteria:
  - Assembles prompt with interpolated variables from previous steps
  - Gets correct provider adapter based on step config
  - Calls adapter.execute() and streams output
  - Captures and stores step output for use by subsequent steps
  - Handles step timeout and retries based on config
  - Detects provider limit errors for fallback handling
tasks:
  - id: context-assembly
    name: Implement context assembly
    description: >-
      Build context object with workflow input, previous step outputs,
      and interpolate variables in prompt template
    status: planned
    estimate: 3h
  - id: adapter-factory
    name: Create adapter factory function
    description: >-
      Factory that returns correct ProviderAdapter based on step.provider config
      (claudeCode, openCode, claudeCodeWithFallback)
    status: planned
    estimate: 2h
  - id: output-capture
    name: Implement output capture and storage
    description: Capture streaming output, store final result for variable interpolation
    status: planned
    estimate: 2h
  - id: timeout-handling
    name: Add timeout and retry logic
    description: Configurable timeout per step, retry with exponential backoff on transient errors
    status: planned
    estimate: 2h
  - id: error-classification
    name: Implement error classification
    description: Classify errors as transient (retry), limit (fallback), or fatal (fail step)
    status: planned
    estimate: 2h
